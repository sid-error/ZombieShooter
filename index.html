<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zombie Shooter</title>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel (for JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900">

  <div id="root"></div>

  <script type="text/babel">

    const { useState, useEffect, useRef } = React;

    const GRID_SIZE = 40;
    const CELL_SIZE = 20;
    const PLAYER_SPEED = 50;
    const ZOMBIE_SPEED = 400;
    const ZOMBIE_WANDER_SPEED = 1200;
    const BULLET_SPEED = 100;
    const ZOMBIE_SPAWN_RATE = 2500;
    const COIN_SPAWN_RATE = 3000;
    const TYPE3_SPAWN_INTERVAL = 8000;
    const MAX_ZOMBIES = 50;

    const ZombieShooter = () => {
      const [player, setPlayer] = useState({ x: 20, y: 20, dir: "up" });
      const [zombies, setZombies] = useState([]);
      const [bullets, setBullets] = useState([]);
      const [coins, setCoins] = useState([]);
      const [walls, setWalls] = useState([]);
      const [score, setScore] = useState(0);
      const [gameOver, setGameOver] = useState(false);
      const [gameStarted, setGameStarted] = useState(false);

      const keysPressed = useRef({});
      const lastMoveTime = useRef(0);
      const lastZombieMove = useRef(0);
      const lastZombieWander = useRef(0);
      const lastZombieSpawn = useRef(0);
      const lastCoinSpawn = useRef(0);
      const type3SpawnTimers = useRef({});
      const zombieIdCounter = useRef(0);

      const isWall = (x, y) => walls.some(w => w.x === x && w.y === y);

      const getRandomPos = () => {
        let pos;
        do {
          pos = {
            x: Math.floor(Math.random() * GRID_SIZE),
            y: Math.floor(Math.random() * GRID_SIZE),
          };
        } while (
          isWall(pos.x, pos.y) ||
          zombies.some(z => z.x === pos.x && z.y === pos.y)
        );
        return pos;
      };

      const generateWalls = () => {
        const newWalls = [];
        for (let i = 0; i < GRID_SIZE * 6; i++) {
          const pos = getRandomPos();
          newWalls.push({ ...pos, id: i });
        }
        return newWalls;
      };

      const spawnZombie = () => ({
        ...getRandomPos(),
        type: 1,
        health: 1,
        id: zombieIdCounter.current++,
      });

      useEffect(() => {
        if (!gameStarted || gameOver) return;

        const down = e => keysPressed.current[e.key.toLowerCase()] = true;
        const up = e => keysPressed.current[e.key.toLowerCase()] = false;
        document.addEventListener("keydown", down);
        document.addEventListener("keyup", up);
        return () => {
          document.removeEventListener("keydown", down);
          document.removeEventListener("keyup", up);
        };
      }, [gameStarted, gameOver]);

      useEffect(() => {
        if (!gameStarted || gameOver) return;

        const loop = setInterval(() => {
          const now = Date.now();

          if (now - lastMoveTime.current > PLAYER_SPEED) {
            setPlayer(p => {
              let { x, y } = p;
              if (keysPressed.current.w) y--;
              if (keysPressed.current.s) y++;
              if (keysPressed.current.a) x--;
              if (keysPressed.current.d) x++;
              if (x >= 0 && y >= 0 && x < GRID_SIZE && y < GRID_SIZE && !isWall(x, y)) {
                return { ...p, x, y };
              }
              return p;
            });
            lastMoveTime.current = now;
          }

          if (now - lastZombieSpawn.current > ZOMBIE_SPAWN_RATE) {
            setZombies(z => z.length < MAX_ZOMBIES ? [...z, spawnZombie()] : z);
            lastZombieSpawn.current = now;
          }
        }, 50);

        return () => clearInterval(loop);
      }, [gameStarted, gameOver]);

      const startGame = () => {
        setWalls(generateWalls());
        setZombies([]);
        setScore(0);
        setGameStarted(true);
        setGameOver(false);
      };

      return (
        <div className="flex flex-col items-center text-white">
          <h1 className="text-3xl font-bold mb-2">Zombie Shooter</h1>
          <p className="mb-2">Score: {score}</p>

          <div style={{
            width: GRID_SIZE * CELL_SIZE,
            height: GRID_SIZE * CELL_SIZE,
            position: "relative",
            background: "#222",
            border: "3px solid #555"
          }}>
            <div style={{
              position: "absolute",
              left: player.x * CELL_SIZE,
              top: player.y * CELL_SIZE,
              width: CELL_SIZE,
              height: CELL_SIZE,
              background: "#4CAF50"
            }} />
          </div>

          {!gameStarted && (
            <button
              onClick={startGame}
              className="mt-4 px-6 py-2 bg-green-600 rounded"
            >
              START GAME
            </button>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<ZombieShooter />);

  </script>
</body>
</html>
